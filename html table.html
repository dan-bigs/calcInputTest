<!DOCTYPE html>
<html>
<head>
    <title>Azure Function Interaction</title>
    <script>
        async function callAzureFunctionForAllColumns() {
            const url = "http://localhost:7071/api/bearing_calculator_v1"; // Replace with your actual function URL
            const table = document.getElementById('inputTable');
            const responseTable = document.getElementById('responseTable');
            responseTable.innerHTML = ''; // Clear previous responses

            console.log('Starting to call Azure Function for all columns');

            // Loop through each column starting from the 2nd column (1-based index)
            for (let j = 1; j < table.rows[0].cells.length; j++) {
                const data = {
                    ULS_max_kN: parseFloat(table.rows[0].cells[j].querySelector('input').value) || 0,
                    ULS_min_kN: parseFloat(table.rows[1].cells[j].querySelector('input').value) || 0,
                    longitudinal_rotation_mrad: parseFloat(table.rows[2].cells[j].querySelector('input').value) || 0,
                    transverse_rotation_mrad: parseFloat(table.rows[3].cells[j].querySelector('input').value) || 0,
                    longitudinal_movement_mm: parseFloat(table.rows[4].cells[j].querySelector('input').value) || 0,
                    transverse_movement_mm: parseFloat(table.rows[5].cells[j].querySelector('input').value) || 0
                };

                // Ensure that all required values are valid numbers
                if (Object.values(data).some(isNaN)) {
                    displayError(j, 'Invalid input. Please enter valid numbers.');
                    continue;
                }

                console.log(`Sending data for column ${j}:`, data);

                try {
                    const startTime = performance.now();

                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    const endTime = performance.now();

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const jsonResponse = await response.json();
                    console.log(`Received response for column ${j}:`, jsonResponse);
                    displayResponse(jsonResponse, j, endTime - startTime);

                } catch (error) {
                    console.error('Error:', error);
                    displayError(j, error.message);
                }
            }

            console.log('Completed calling Azure Function for all columns');
        }

        function displayResponse(response, columnIndex, time) {
            const table = document.getElementById('responseTable');
            let rowIndex = 0;

            for (const [key, value] of Object.entries(response)) {
                if (!table.rows[rowIndex]) {
                    const row = table.insertRow(rowIndex);
                    row.insertCell(0).innerText = key;
                }
                const cell = table.rows[rowIndex].insertCell(columnIndex);
                cell.innerText = value;
                rowIndex++;
            }

            // Display execution time
            if (!table.rows[rowIndex]) {
                const row = table.insertRow(rowIndex);
                row.insertCell(0).innerText = "Execution Time";
            }
            const cell = table.rows[rowIndex].insertCell(columnIndex);
            cell.innerText = time.toFixed(3);
        }

        function displayError(columnIndex, message) {
            const table = document.getElementById('responseTable');
            const row = table.insertRow(-1);
            row.insertCell(0).innerText = "Error";
            row.insertCell(columnIndex).innerText = message;
        }
    </script>
</head>
<body>

<h2>Input Table</h2>
<table id="inputTable" border="1">
    <tr>
        <th>ULS_max_kN</th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
    </tr>
    <tr>
        <th>ULS_min_kN</th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
    </tr>
    <tr>
        <th>longitudinal_rotation_mrad</th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
    </tr>
    <tr>
        <th>transverse_rotation_mrad</th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
    </tr>
    <tr>
        <th>longitudinal_movement_mm</th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
    </tr>
    <tr>
        <th>transverse_movement_mm</th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
        <th><input type="text" /></th>
    </tr>
</table>

<button onclick="callAzureFunctionForAllColumns()">Submit</button>

<h2>Response Table</h2>
<table id="responseTable" border="1">
    <!-- Response will be inserted here -->
</table>

</body>
</html>
